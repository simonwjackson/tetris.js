{"version":3,"sources":["src\\utils.js","src\\core.js","src\\tetris.js","node_modules\\parcel\\src\\builtins\\bundle-url.js","node_modules\\parcel\\src\\builtins\\css-loader.js"],"names":["createMatrix","w","h","matrix","push","Array","fill","rand","min","max","Math","ceil","floor","random","createPiece","type","hasCollision","arena","player","m","o","pos","some","yVal","yIdx","xVal","xIdx","y","x","module","hot","dispose","window","location","reload","scale","border","colors","canvas","document","getElementById","context","getContext","score","dropCounter","dropInterval","lastDraw","arenaSweep","rowCount","outer","length","row","splice","unshift","merge","map","value","playerDrop","playerReset","updateScore","innerHTML","draw","fillStyle","fillRect","width","height","drawMatrix","update","time","deltaTimeDraw","requestAnimationFrame","bind","offset","drawSquare","color","squareSize","startX","startY","strokeStyle","lineWidth","strokeRect","move","direction","rotate","r","reverse","playerRotate","dir","pieces","num","letter","bindControls","addEventListener","key","init","bundleURL","getBundleURLCached","getBundleURL","Error","err","matches","stack","match","getBaseURL","url","replace","exports","bundle","require","updateLink","link","newLink","cloneNode","onload","remove","href","split","Date","now","parentNode","insertBefore","nextSibling","cssTimeout","reloadCSS","setTimeout","links","querySelectorAll","i"],"mappings":"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","file":"tetris.2155d54d.map","sourceRoot":"..","sourcesContent":["// Refactor as reducer\r\nexport const createMatrix = (w, h) => { \r\n  const matrix = []\r\n  while (h--) {\r\n    matrix.push(new Array(w).fill(0))\r\n  }\r\n  return matrix \r\n}\r\n\r\nexport const rand = (min, max) => {\r\n  min = Math.ceil(min)\r\n  max = Math.floor(max)\r\n\r\n  return Math.floor(Math.random() * (max - min + 1)) + min //The maximum is inclusive and the minimum is inclusive\r\n}\r\n","export const createPiece = type => {\r\n  switch (type) {\r\n    case \"O\":\r\n      return [\r\n        [1, 1],\r\n        [1, 1],\r\n      ]\r\n      break\r\n\r\n    case \"Z\":\r\n      return [\r\n        [2, 2, 0],\r\n        [0, 2, 2],\r\n        [0, 0, 0]\r\n      ]\r\n      break\r\n\r\n    case \"S\":\r\n      return [\r\n        [0, 3, 3],\r\n        [3, 3, 0],\r\n        [0, 0, 0]\r\n      ]\r\n      break\r\n\r\n    case \"J\":\r\n      return [\r\n        [0, 1, 0],\r\n        [0, 1, 0],\r\n        [1, 1, 0]\r\n      ]\r\n      break \r\n\r\n    case \"L\":\r\n      return [\r\n        [0, 2, 0],\r\n        [0, 2, 0],\r\n        [0, 2, 2]\r\n      ]\r\n      break\r\n\r\n    case \"I\":\r\n      return [\r\n        [0, 2, 0, 0],\r\n        [0, 2, 0, 0],\r\n        [0, 2, 0, 0],\r\n        [0, 2, 0, 0]\r\n      ]\r\n      break\r\n\r\n    case \"T\": \r\n      return [\r\n        [0, 0, 0],\r\n        [3, 3, 3],\r\n        [0, 3, 0]\r\n      ]\r\n      break\r\n  }\r\n}\r\n\r\nexport const hasCollision = (arena, player) => {\r\n  const m = player.matrix\r\n  const o = player.pos\r\n\r\n  return m.some((yVal, yIdx) => (\r\n    yVal.some((xVal, xIdx) => {\r\n      if (m[yIdx][xIdx] !== 0 &&\r\n        (arena[yIdx + o.y] &&\r\n          arena[yIdx + o.y][xIdx + o.x]) !== 0) {\r\n        return true\r\n      } \r\n\r\n      return false\r\n    })\r\n  ))\r\n}","/* HOTFIX: Parcel full reload for canvas */\r\nif (module.hot) {\r\n  module.hot.dispose(() => {\r\n    window.location.reload();\r\n    throw 'whatever'\r\n  })\r\n}\r\n\r\nimport './main.css'\r\nimport { createMatrix, rand } from './utils'\r\nimport { hasCollision, createPiece } from './core'\r\n\r\nconst scale = 20\r\nconst border = scale * .1\r\nconst colors = [\r\n  null,\r\n  'hsl(203, 100%, 67%)',\r\n  'hsl(226, 96%, 56%)',\r\n  'hsl(0, 0%, 99%)'\r\n]\r\nconst canvas = document.getElementById('tetris')\r\nconst context = canvas.getContext('2d')\r\nconst arena = createMatrix(10, 20)\r\nconst player = {\r\n  pos: {\r\n    x: 0,\r\n    y: 0\r\n  },\r\n  matrix: null,\r\n  score: 0\r\n}\r\n\r\nlet dropCounter = 0\r\nlet dropInterval = 1000\r\nlet lastDraw = 0\r\n\r\n// context.scale(10, 10)\r\n\r\nconst arenaSweep = () => {\r\n  let rowCount = 1\r\n  outer: for (let y = arena.length - 1; y > 0; --y) {\r\n    for (let x = 0; x < arena[y].length; ++x) {\r\n      if (arena[y][x] === 0) {\r\n        continue outer;\r\n      }\r\n    }\r\n\r\n    const row = arena.splice(y, 1)[0].fill(0)\r\n    arena.unshift(row)\r\n    ++y\r\n\r\n    player.score += rowCount * 10\r\n    rowCount *= 2\r\n  }\r\n}\r\n\r\nconst merge = (arena, player) => {\r\n  player.matrix.map((row, y) => {\r\n    row.map((value, x) => {\r\n      if (value !== 0) arena[y + player.pos.y][x + player.pos.x] = value\r\n    })\r\n  })\r\n}\r\n\r\nconst playerDrop = () => {\r\n  player.pos.y++\r\n\r\n  if (hasCollision(arena, player)) {\r\n    player.pos.y--\r\n    merge(arena, player)\r\n    playerReset()\r\n    arenaSweep()\r\n    updateScore(player.score)\r\n    player.pos.y = 0\r\n  }\r\n\r\n  dropCounter = 0\r\n}\r\n\r\nconst updateScore = score => {\r\n  document.getElementById('score').innerHTML = score\r\n}\r\n\r\nconst draw = player => {\r\n  context.fillStyle = '#000'\r\n  context.fillRect(0, 0, canvas.width, canvas.height)\r\n\r\n  drawMatrix(arena, { x: 0, y: 0 }) // Existing blocks\r\n  drawMatrix(player.matrix, player.pos) // Current block\r\n}\r\n\r\nconst update = (player, time = 0) => {\r\n  const deltaTimeDraw = time - lastDraw\r\n  lastDraw = time\r\n\r\n  dropCounter += deltaTimeDraw\r\n  if (dropCounter > dropInterval) playerDrop()\r\n\r\n  draw(player)\r\n  requestAnimationFrame(update.bind(null, player))\r\n}\r\n\r\nconst drawMatrix = (matrix, offset) => {\r\n  matrix.map((row, y) => {\r\n    row.map((value, x) => {\r\n      if (value !== 0) {\r\n        drawSquare(colors[value], x, y, offset, scale, border)\r\n      }\r\n    })\r\n  })\r\n}\r\n\r\nconst drawSquare = (color, x, y, offset, scale, border) => {\r\n  const squareSize = scale - border\r\n  const startX = (x + offset.x) * scale\r\n  const startY = (y + offset.y) * scale\r\n  context.fillStyle = color\r\n  context.fillRect(startX, startY, squareSize, squareSize)\r\n  context.fillStyle = 'white'\r\n  context.fillRect(startX, startY, 2, 2)\r\n  context.fillRect(startX + 2, startY + 2, 2, 4)\r\n  context.fillRect(startX + 2, startY + 2, 4, 2)\r\n\r\n  if (color === 'hsl(0, 0%, 99%)') { \r\n    context.strokeStyle = colors[1];\r\n    context.lineWidth = 3;\r\n    context.strokeRect(startX + 1, startY + 1, squareSize - 2, squareSize - 2);\r\n  }\r\n}\r\n\r\nconst move = direction => {\r\n  player.pos.x += direction\r\n  if (hasCollision(arena, player))\r\n    player.pos.x -= direction\r\n}\r\n\r\nconst rotate = (matrix, direction) => {\r\n  for (let yIdx = 0; yIdx < matrix.length; ++yIdx) {\r\n    for (let xIdx = 0; xIdx < yIdx; ++xIdx) {\r\n      [\r\n        matrix[xIdx][yIdx],\r\n        matrix[yIdx][xIdx]\r\n      ] = [\r\n          matrix[yIdx][xIdx],\r\n          matrix[xIdx][yIdx]\r\n        ]\r\n    }\r\n  }\r\n\r\n  if (direction > 0) matrix.map(r => r.reverse())\r\n  else matrix.reverse()\r\n}\r\n\r\nconst playerRotate = direction => {\r\n  const pos = player.pos.x\r\n  let offset = 1\r\n  rotate(player.matrix, direction)\r\n\r\n  while (hasCollision(arena, player)) {\r\n    player.pos.x += offset\r\n    offset = -(offset + (offset > 0 ? 1 : -1))\r\n    if (offset > player.matrix[0].length) {\r\n      rotate(player.matrix, -dir)\r\n      player.pos.x = pos\r\n      return\r\n    }\r\n  }\r\n  // const { x: pos } = player.pos\r\n  // let offset = 1\r\n  // rotate(player.matrix, direction) \r\n  // console.table(hasCollision(arena, matrix))\r\n  // while (hasCollision(arena, matrix)) {\r\n  //   player.pos.x += offset\r\n  //   offset = -(offset + (offset > 0 ? 1 : -1))\r\n  //   if (offset > player.matrix[0].length) {\r\n  //     rotate(player.matrix, -dir)\r\n  //     player.pos.x = pos\r\n  //     return\r\n  //   }\r\n  // }\r\n}\r\n\r\nconst playerReset = () => {\r\n  const pieces = 'ILJOTSZ'\r\n  const num = rand(0, pieces.length - 1)\r\n  const letter = pieces[num]\r\n\r\n  player.matrix = createPiece(letter)\r\n  player.pos.y = 0\r\n  player.pos.x = (arena[0].length / 2 | 0) -\r\n    (player.matrix[0].length / 2 | 0)\r\n\r\n  // Clear Screen\r\n  if (hasCollision(arena, player)) {\r\n    arena.map(row => row.fill(0))\r\n    player.score = 0\r\n    updateScore()\r\n  }\r\n}\r\n\r\nconst bindControls = player => {\r\n  document.addEventListener('keydown', ({ key }) => {\r\n    switch (key) {\r\n      case \"ArrowLeft\":\r\n        move(-1)\r\n        break\r\n      case \"ArrowRight\":\r\n        move(1)\r\n        break\r\n      case \"ArrowDown\":\r\n        playerDrop()\r\n        break\r\n      case \"q\":\r\n        playerRotate(1)\r\n        break\r\n      case \"w\":\r\n        playerRotate(-1)\r\n        break\r\n    }\r\n  })\r\n}\r\n\r\nconst init = () => {\r\n  bindControls(player)\r\n  playerReset()\r\n  updateScore(player.score)\r\n}\r\n\r\ninit()\r\nupdate(player)\r\n","var bundleURL = null;\nfunction getBundleURLCached() {\n  if (!bundleURL) {\n    bundleURL = getBundleURL();\n  }\n\n  return bundleURL;\n}\n\nfunction getBundleURL() {\n  // Attempt to find the URL of the current script and use that as the base URL\n  try {\n    throw new Error;\n  } catch (err) {\n    var matches = ('' + err.stack).match(/(https?|file|ftp):\\/\\/[^)\\n]+/g);\n    if (matches) {\n      return getBaseURL(matches[0]);\n    }\n  }\n\n  return '/';\n}\n\nfunction getBaseURL(url) {\n  return ('' + url).replace(/^((?:https?|file|ftp):\\/\\/.+)\\/[^/]+$/, '$1') + '/';\n}\n\nexports.getBundleURL = getBundleURLCached;\nexports.getBaseURL = getBaseURL;\n","var bundle = require('./bundle-url');\n\nfunction updateLink(link) {\n  var newLink = link.cloneNode();\n  newLink.onload = function () {\n    link.remove();\n  };\n  newLink.href = link.href.split('?')[0] + '?' + Date.now();\n  link.parentNode.insertBefore(newLink, link.nextSibling);\n}\n\nvar cssTimeout = null;\nfunction reloadCSS() {\n  if (cssTimeout) {\n    return;\n  }\n\n  cssTimeout = setTimeout(function () {\n    var links = document.querySelectorAll('link[rel=\"stylesheet\"]');\n    for (var i = 0; i < links.length; i++) {\n      if (bundle.getBaseURL(links[i].href) === bundle.getBundleURL()) {\n        updateLink(links[i]);\n      }\n    }\n\n    cssTimeout = null;\n  }, 50);\n}\n\nmodule.exports = reloadCSS;\n"]}